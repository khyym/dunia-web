<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>dunia - email doğrulandı</title>
    <meta name="robots" content="noindex">
    <meta name="apple-itunes-app" content="app-id=YOUR_APP_ID">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;
            background: #000407;
            color: #fff;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 24px;
        }
        .card {
            background: linear-gradient(180deg, rgba(255,255,255,0.06) 0%, rgba(255,255,255,0.02) 100%);
            border-radius: 28px;
            padding: 48px 36px;
            max-width: 380px;
            width: 100%;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.08);
        }
        .logo {
            width: 80px;
            height: 80px;
            margin: 0 auto 24px;
            background: #111;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .logo img {
            width: 60px;
            height: 60px;
        }
        .spinner {
            width: 32px;
            height: 32px;
            border: 3px solid rgba(255,255,255,0.1);
            border-top-color: #fff;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 28px;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .checkmark {
            width: 32px;
            height: 32px;
            margin: 0 auto 28px;
            font-size: 28px;
            display: none;
        }
        .title {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 12px;
        }
        .message {
            font-size: 15px;
            color: rgba(255,255,255,0.6);
            line-height: 1.5;
            margin-bottom: 28px;
        }
        .btn {
            display: inline-block;
            width: 100%;
            padding: 16px 32px;
            background: #fff;
            color: #000;
            font-size: 16px;
            font-weight: 600;
            text-decoration: none;
            border-radius: 50px;
            margin-bottom: 16px;
            transition: transform 0.2s, opacity 0.2s;
        }
        .btn:hover { transform: scale(1.02); }
        .btn:active { transform: scale(0.98); }
        .btn.hidden { display: none; }
        .status {
            font-size: 13px;
            color: rgba(255,255,255,0.4);
        }
        .status.hidden { display: none; }
        .confetti {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: 100;
        }
        .confetti-piece {
            position: absolute;
            width: 8px; height: 8px;
            animation: confettiFall 3s ease-out forwards;
        }
        @keyframes confettiFall {
            0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in { animation: fadeIn 0.4s ease forwards; }
    </style>
</head>
<body>
    <div class="card">
        <div class="logo">
            <img src="https://dunia.one/images/logo.png" alt="dunia">
        </div>
        <div class="spinner" id="spinner"></div>
        <div class="checkmark" id="checkmark">✓</div>
        <h1 class="title" id="title">email doğrulandı! ✓</h1>
        <p class="message" id="message">hesabın onaylandı. şimdi uygulamayı açarak doğrulanmış profilini görebilirsin.</p>
        <a href="#" class="btn hidden" id="btn">devam et</a>
        <p class="status" id="status">dunia açılıyor...</p>
    </div>
    
    <div class="confetti" id="confetti"></div>

    <script>
        (function() {
            const APP_STORE_URL = 'https://apps.apple.com/app/dunia/id6450894038';
            
            // Parse URL params
            const params = new URLSearchParams(window.location.search);
            const hash = window.location.hash;
            const hashParams = new URLSearchParams(hash.replace('#', ''));
            
            const token = params.get('token') || hashParams.get('token') || hashParams.get('access_token') || params.get('access_token');
            const userId = params.get('user_id') || hashParams.get('user_id');
            const type = params.get('type') || hashParams.get('type') || 'verify';
            
            // DOM elements
            const spinner = document.getElementById('spinner');
            const checkmark = document.getElementById('checkmark');
            const title = document.getElementById('title');
            const message = document.getElementById('message');
            const btn = document.getElementById('btn');
            const status = document.getElementById('status');
            const confettiContainer = document.getElementById('confetti');
            
            // Build deep link
            function buildDeepLink() {
                const dlParams = new URLSearchParams();
                if (type) dlParams.set('type', type);
                if (token) dlParams.set('token', token);
                if (userId) dlParams.set('user_id', userId);
                return 'dunia://auth/callback?' + dlParams.toString();
            }
            
            const deepLink = buildDeepLink();
            
            // Confetti effect
            function showConfetti() {
                const colors = ['#22c55e', '#3b82f6', '#8b5cf6', '#ec4899', '#ffffff'];
                for (let i = 0; i < 50; i++) {
                    const piece = document.createElement('div');
                    piece.className = 'confetti-piece';
                    piece.style.left = Math.random() * 100 + '%';
                    piece.style.background = colors[Math.floor(Math.random() * colors.length)];
                    piece.style.animationDelay = Math.random() * 0.5 + 's';
                    piece.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                    confettiContainer.appendChild(piece);
                }
                setTimeout(() => { confettiContainer.innerHTML = ''; }, 4000);
            }
            
            // Show success state
            function showSuccess() {
                spinner.style.display = 'none';
                checkmark.style.display = 'block';
                showConfetti();
            }
            
            // Show button (when app can't be opened)
            function showButton() {
                status.classList.add('hidden');
                btn.classList.remove('hidden');
                btn.classList.add('fade-in');
                btn.href = deepLink;
                
                // On button click, try deep link first, then App Store
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Try to open app
                    window.location.href = deepLink;
                    
                    // If app doesn't open in 1.5 seconds, go to App Store
                    setTimeout(function() {
                        if (!document.hidden) {
                            window.location.href = APP_STORE_URL;
                        }
                    }, 1500);
                });
            }
            
            // Initialize
            showSuccess();
            
            // Try to open app automatically
            let appOpened = false;
            
            document.addEventListener('visibilitychange', function() {
                if (document.hidden) {
                    appOpened = true;
                }
            });
            
            // Try deep link after short delay
            setTimeout(function() {
                window.location.href = deepLink;
            }, 800);
            
            // After 3 seconds, if app didn't open, show button
            setTimeout(function() {
                if (!appOpened && !document.hidden) {
                    showButton();
                }
            }, 3000);
            
        })();
    </script>
</body>
</html>
